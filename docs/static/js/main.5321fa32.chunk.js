(this.webpackJsonpzitao_shen_assignment5=this.webpackJsonpzitao_shen_assignment5||[]).push([[0],{41:function(e,t,s){},45:function(e,t,s){"use strict";s.r(t);var a=s(2),c=s.n(a),n=s(18),i=s.n(n),l=s(3),r=(s(40),s(41),s(15)),o="LOGIN_SUCCESS",d="INVALID_LOGIN",j="LOGIN_NETWORK_ERROR",b="LOGOUT",u="STORE_THREAD",m="STORE_POSTS",h="POPULATE_THREADS",g="POPULATE_POST",O="CLEAR_POSTS",x="PRESENT_A_THREAD",p="logged in",f="logged out",v="invalid login",y="network error",N={loginState:f},S={},w=s(24),_={thread:{},tags:[],selectThread:void 0},k={posts:[]},T=s(28),C=Object(r.c)({login:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case o:return{loginState:p};case d:return{loginState:v};case j:return{loginState:y};case b:return{loginState:f};default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case o:return t.payload.user;case b:return S;default:return e}},threads:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u:return{thread:t.payload.thread,tags:t.payload.tags};case x:return Object(w.a)(Object(w.a)({},e),{},{selectThread:t.payload.selectThread});case h:return{thread:t.payload.thread,tags:t.payload.tags};case b:return _;default:return e}},posts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m:case O:case g:return{posts:t.payload.posts};case b:return k;default:return e}}}),F=Object(r.d)(C,Object(r.a)(T.a)),V=s(23);s(46);V.a.initializeApp({apiKey:"AIzaSyC7QtSboADmY-1WeqSAsncFUuNEG85SPws",authDomain:"project5-9ecbd.firebaseapp.com",projectId:"project5-9ecbd",storageBucket:"project5-9ecbd.appspot.com",messagingSenderId:"226792902705",appId:"1:226792902705:web:91f338e672f141c2e40510",measurementId:"G-997QXT3ZXE"});var E=V.a.firestore(),P=function(e){for(var t=e.concat(),s=0;s<t.length;++s)for(var a=s+1;a<t.length;++a)t[s]===t[a]&&t.splice(a--,1);return t},D=function(e){return{type:x,payload:{selectThread:e}}},A=function(e,t){return function(s){E.collection("user").where("name","==",e).where("password","==",t).get().then((function(e){if(1===e.size){var t=e.docs[0],a={id:t.id,name:t.data().name};s(function(e){return{type:o,payload:{user:e}}}(a))}else s({type:d})})).catch((function(e){console.log(e),s({type:j})}))}},I=function(){var e=[];return function(t){E.collection("thread").get().then((function(s){if(s.size>0){var a={};s.forEach((function(t){a[t.id]={thread_id:t.id,id:t.data().id,message:t.data().message,post_time:t.data().post_time,tags:t.data().tags,title:t.data().title},e=P(e.concat(a[t.id].tags))})),console.log(a),console.log(e),t(function(e,t){return{type:u,payload:{thread:e,tags:t}}}(a,e))}else console.log("No post")})).catch((function(e){console.log(e)}))}},L=function(e,t,s,a,c){var n=F.getState().threads.thread,i=F.getState().threads.tags,l=P(i.concat(s));return function(i){E.collection("thread").add({id:c,message:e,title:t,post_time:a,tags:s}).then((function(r){n[r.id]={thread_id:r.id,id:c,message:e,title:t,post_time:a,tags:s},i(function(e,t){return{type:h,payload:{thread:e,tags:t}}}(n,l))})).catch((function(e){return console.log(e)}))}},R=function(e){return function(t){E.collection("thread").doc(e).collection("posts").get().then((function(e){if(e.size>0){var s=[];e.forEach((function(e){s.push({post_id:e.id,id:e.data().id,message:e.data().message,post_time:e.data().post_time})})),console.log(s),t(function(e){return{type:m,payload:{posts:e}}}(s))}})).catch((function(e){console.log(e)}))}},U=function(e,t,s,a){var c=F.getState().posts.posts;return function(n){E.collection("thread").doc(a).collection("posts").add({id:s,message:e,post_time:t}).then((function(a){c.push({post_id:a.id,id:s,message:e,post_time:t}),n({type:g,payload:{posts:c}})})).catch((function(e){return console.log(e)}))}},z=s(29),B=s(11),G=s(6),M=s(7),K=s(1),H=function(e){var t=new Date(e.thread.post_time);return Object(K.jsxs)("div",{className:"card text-dark bg-light mb-3",style:{marginBottom:"1em"},children:[Object(K.jsxs)("div",{className:"card-header",children:["Posted by: ",t.toString()]}),Object(K.jsxs)("div",{className:"card-body",children:[Object(K.jsx)("h2",{className:"card-title",children:e.thread.title}),Object(K.jsxs)("h3",{className:"card-subtitle",children:["From: ",e.thread.id," "]}),Object(K.jsxs)("h4",{className:"card-text text-end",children:[" ",Object(K.jsx)(G.a,{icon:M.k})," ",e.thread.tags.toString()]}),Object(K.jsx)("p",{className:"card-text mt-3 thread-p ",children:e.thread.message})]})]},e.thread.id)},J=function(e){var t=Object(l.c)((function(e){return e.login.loginState})),s=Object(l.c)((function(e){return e.threads.thread})),c=Object(l.c)((function(e){return e.user})),n=Object(l.b)(),i=Object(a.useState)({message:"",isValid:void 0}),r=Object(B.a)(i,2),o=r[0],d=r[1],j=o.isValid&&"logged in"===t,b=function(){d({message:"",isValid:void 0})};return Object(K.jsxs)("div",{className:"p-3",children:[Object(K.jsxs)("h2",{className:"display-6 font-weight-bold text-dark ",children:["Replay ",Object(K.jsx)(G.a,{icon:M.h})," "]}),Object(K.jsxs)("div",{className:"row my-2",children:[Object(K.jsx)("label",{className:"col-sm-3 col-form-label text-center fst-italic h5",htmlFor:"message",children:"Message:"}),Object(K.jsxs)("div",{className:"col-sm-9",children:[Object(K.jsx)("textarea",{id:"message",className:"form-control",value:o.message,onChange:function(e){var t;d({message:(t=e).target.value,isValid:t.target.value.length>0})}}),Object(K.jsx)("div",{className:"invalid-feedback",style:!1===o.isValid?{display:"block"}:{display:"none"},children:"Message cannot be empty"})]})]}),Object(K.jsx)("div",{className:"row my-2",children:Object(K.jsx)("div",{className:"col text-end",children:Object(K.jsx)("button",{className:"btn btn-primary btn-lg",type:"submit",disabled:!j,onClick:function(){return function(){var t=c.name,a=Date.now();n(U(o.message,a,t,e.id)),n(R(s[e.id].thread_id)),b()}()},children:"submit "})})})]})},Q=function(e){var t=Object(l.c)((function(e){return e.threads.thread})),s=Object(l.c)((function(e){return e.login.loginState})),c=Object(l.b)();Object(a.useEffect)((function(){c(R(t[e.id].thread_id))}),[c]);var n=Object(l.c)((function(e){return e.posts.posts})),i=n.sort((function(e,t){return e.post_time>t.post_time?1:-1}));console.log(n);var r=new Date(t[e.id].post_time),o=function(e){return new Date(e).toString()};return Object(K.jsxs)("div",{className:"p-2",children:[Object(K.jsxs)("h2",{className:"display-5 font-weight-bold text-primary",children:[" Post ",Object(K.jsx)(G.a,{icon:M.e})]}),Object(K.jsxs)("div",{className:"card text-dark bg-light mb-3",style:{marginBottom:"1em"},children:[Object(K.jsxs)("div",{className:"card-header",children:["Posted by: ",r.toString()]}),Object(K.jsxs)("div",{className:"card-body",children:[Object(K.jsx)("h2",{className:"card-title",children:t[e.id].title}),Object(K.jsxs)("h3",{className:"card-subtitle",children:["From: ",t[e.id].id," "]}),Object(K.jsxs)("h4",{className:"card-text text-end",children:[" ",Object(K.jsx)(G.a,{icon:M.k})," ",t[e.id].tags.toString()]}),Object(K.jsx)("p",{className:"card-text mt-3 message",children:t[e.id].message})]})]},e.id),Object(K.jsx)("div",{children:i.map((function(t,s){return Object(K.jsxs)("div",{className:"card text-dark bg-light mb-3",style:{marginBottom:"1em"},children:[Object(K.jsxs)("div",{className:"card-header",children:["Posted by: ",o(t.post_time)]}),Object(K.jsxs)("div",{className:"card-body",children:[Object(K.jsxs)("h3",{className:"card-subtitle",children:["From: ",t.id," "]}),Object(K.jsx)("p",{className:"card-text mt-3 message",children:t.message})]})]},e.id)}))}),"logged in"===s?Object(K.jsx)(K.Fragment,{children:Object(K.jsx)(J,{id:e.id})}):""]})},W=function(e){var t=Object(l.c)((function(e){return e.threads.thread})),s=Object(l.b)(),a=function(t){0===t?(s({type:O,payload:{posts:[]}}),s(D(void 0))):s(D(e.id))};return Object(K.jsx)("div",{className:"p-4",children:0===e.index?Object(K.jsxs)(K.Fragment,{children:[Object(K.jsx)(H,{thread:t[e.id]}),Object(K.jsxs)("button",{className:"btn btn-outline-primary btn-lg",onClick:function(){return a(1)},children:["See posts ",Object(K.jsx)(G.a,{icon:M.b})]})]}):Object(K.jsxs)(K.Fragment,{children:[Object(K.jsx)(Q,{id:e.id}),Object(K.jsxs)("button",{className:"btn btn-outline-primary btn-lg",onClick:function(){return a(0)},children:[" ",Object(K.jsx)(G.a,{icon:M.a})," Back "]})]})})},X=function(){var e=Object(l.c)((function(e){return e.login.loginState})),t=Object(l.c)((function(e){return e.user})),s=Object(l.b)(),c=Object(a.useState)({title:"",isValid:void 0}),n=Object(B.a)(c,2),i=n[0],r=n[1],o=Object(a.useState)({message:"",isValid:void 0}),d=Object(B.a)(o,2),j=d[0],b=d[1],u=Object(a.useState)({tags:[],isValid:void 0}),m=Object(B.a)(u,2),h=m[0],g=m[1],O=h.isValid&&j.isValid&&i.isValid&&"logged in"===e,x=function(){r({title:"",isValid:void 0}),b({message:"",isValid:void 0}),g({tags:[],isValid:void 0})};return Object(K.jsxs)("div",{children:[Object(K.jsxs)("h2",{className:"display-5 font-weight-bold text-dark",children:["Post a new thread ",Object(K.jsx)(G.a,{icon:M.d})]}),Object(K.jsxs)("div",{className:"row my-2",children:[Object(K.jsx)("label",{className:"col-sm-3 col-form-label  text-center fst-italic h5",htmlFor:"title",children:"Title:"}),Object(K.jsxs)("div",{className:"col-sm-9",children:[Object(K.jsx)("input",{id:"title",className:"form-control",type:"text",value:i.title,onChange:function(e){var t;r({title:(t=e).target.value,isValid:t.target.value.length>0})}}),Object(K.jsx)("div",{className:"invalid-feedback",style:!1===i.isValid?{display:"block"}:{display:"none"},children:"Title cannot be empty"})]})]}),Object(K.jsxs)("div",{className:"row my-2",children:[Object(K.jsx)("label",{className:"col-sm-3 col-form-label text-center fst-italic h5",htmlFor:"message",children:"Message:"}),Object(K.jsxs)("div",{className:"col-sm-9",children:[Object(K.jsx)("textarea",{id:"message",className:"form-control",value:j.message,onChange:function(e){var t;b({message:(t=e).target.value,isValid:t.target.value.length>0})}}),Object(K.jsx)("div",{className:"invalid-feedback",style:!1===j.isValid?{display:"block"}:{display:"none"},children:"Message cannot be empty"})]})]}),Object(K.jsxs)("div",{className:"row my-2",children:[Object(K.jsxs)("label",{className:"col-sm-3 col-form-label   text-center fst-italic h5",htmlFor:"tags",children:["Tags: ",Object(K.jsx)("span",{className:"text-secondary",children:"Multiple tags separated by comma"})]}),Object(K.jsxs)("div",{className:"col-sm-9",children:[Object(K.jsx)("input",{id:"tags",className:"form-control",type:"text",value:h.tags,onChange:function(e){return function(e){var t=[];if(e.target.value.length>0){for(var s=e.target.value.split(","),a=0;a<s.length;a++)t.push(s[a]);g({tags:t,isValid:!0})}else g({isValid:!1})}(e)}}),Object(K.jsx)("div",{className:"invalid-feedback",style:!1===h.isValid?{display:"block"}:{display:""},children:"tags cannot be empty"})]})]}),Object(K.jsx)("div",{className:"row my-2",children:Object(K.jsx)("div",{className:"col text-end",children:Object(K.jsx)("button",{className:"btn btn-primary btn-lg",type:"submit",disabled:!O,onClick:function(){return function(){var e=t.name,a=Date.now();s(L(j.message,i.title,h.tags,a,e)),x()}()},children:"submit "})})})]})},Z=!1,q=function(){var e=Object(a.useState)(""),t=Object(B.a)(e,2),s=t[0],c=t[1],n=Object(a.useState)(""),i=Object(B.a)(n,2),r=i[0],o=i[1],d=Object(l.c)((function(e){return e.login.loginState})),j=Object(l.b)(),b=function(){j(A(s,r)),m()},u=function(e){13===e.keyCode&&(e.preventDefault(),b())},m=function(){Z=!1,c(""),o("")};return Object(K.jsxs)("div",{className:"bottom-container",children:[Object(K.jsxs)("h2",{className:"display-5 font-weight-bold text-dark",children:["Sign in to post ",Object(K.jsx)(G.a,{icon:M.l})]}),Object(K.jsx)("p",{children:" Using username:zitao password:1234"}),!Z&&d===v&&Object(K.jsx)("div",{className:"alert alert-danger",role:"alert",children:"Invalid username / password! Please try again."}),!Z&&d===y&&Object(K.jsx)("div",{className:"alert alert-danger",role:"alert",children:"Unable to connect to the server. Please check your internet connection."}),Object(K.jsxs)("div",{className:"row my-4 add-form",children:[Object(K.jsx)("div",{className:"col-12 col-sm-2",children:Object(K.jsx)("label",{htmlFor:"username",className:"form-label   fst-italic h5",children:"Username:"})}),Object(K.jsx)("div",{className:"col",children:Object(K.jsx)("input",{type:"text",id:"username",name:"username",className:"form-control",value:s,onChange:function(e){Z=!0,c(e.target.value)},onKeyUp:function(e){return u(e)}})})]}),Object(K.jsxs)("div",{className:"row my-4 add-form",children:[Object(K.jsx)("div",{className:"col-12 col-sm-2",children:Object(K.jsx)("label",{htmlFor:"password",className:"form-label  fst-italic h5",children:"Password:"})}),Object(K.jsx)("div",{className:"col",children:Object(K.jsx)("input",{type:"password",id:"password",name:"password",className:"form-control",value:r,onChange:function(e){Z=!0,o(e.target.value)},onKeyUp:function(e){return u(e)}})})]}),Object(K.jsx)("div",{className:"row",children:Object(K.jsx)("div",{className:"col",children:Object(K.jsxs)("button",{className:"btn btn-secondary float-end",onClick:b,children:["Log in ",Object(K.jsx)(G.a,{icon:M.i})]})})})]})},Y=function(){return Object(K.jsxs)("div",{className:"d-flex align-items-center h1",children:[Object(K.jsx)("strong",{children:"Loading..."}),Object(K.jsx)("div",{className:"spinner-border ms-auto",role:"status","aria-hidden":"true"})]})},$=function(){var e=Object(l.c)((function(e){return e.threads.tags}));console.log(e);var t=Object(l.c)((function(e){return e.threads.thread})),s=Object(l.c)((function(e){return e.login.loginState})),c=Object(l.c)((function(e){return e.threads.selectThread})),n=Object(a.useState)([]),i=Object(B.a)(n,2),r=i[0],o=i[1],d=Object(l.b)(),j=Object(l.c)((function(e){return e}));console.log(j);var u=function(){d({type:b}),d(I())},m=Object.keys(t).sort((function(e,s){return-1*(t[e].post_time-t[s].post_time)}));return Object(K.jsx)(K.Fragment,{children:0===Object.keys(t).length?Object(K.jsx)(Y,{}):void 0===c?Object(K.jsxs)(K.Fragment,{children:[Object(K.jsxs)("div",{className:"filter",children:[Object(K.jsxs)("h2",{className:"display-5 font-weight-bold text-success",children:["Filter ",Object(K.jsx)(G.a,{icon:M.f})]}),Object(K.jsx)("div",{className:"container my-4",children:Object(K.jsxs)("div",{className:"row my-2",children:[Object(K.jsx)("label",{className:"col-sm-2 col-form-label",htmlFor:"selectCategory",children:Object(K.jsxs)("p",{className:"h3 text-center text-success fst-italic",children:[Object(K.jsx)(G.a,{icon:M.k})," Tags: "]})}),Object(K.jsx)("div",{className:"col-sm-10",children:Object(K.jsxs)("select",{id:"selectCategory",className:"form-select",multiple:!0,onChange:function(e){var t=e.target,s=Array.from(t.selectedOptions,(function(e){return e.value}));o(Object(z.a)(s))},children:[Object(K.jsx)("option",{value:" ",disabled:!0,className:"option",children:"Select one/multiple tags (by using Ctrl+click to select multiple, Ctrl + double click to unselect)"}),e.map((function(e,t){return Object(K.jsx)("option",{value:e,className:"option",children:e},t)}))]})})]})})]}),Object(K.jsxs)("h2",{className:"display-5 font-weight-bold text-primary",children:["Threads ",Object(K.jsx)(G.a,{icon:M.g})]}),Object(K.jsx)("div",{className:"thread",children:0===r.length?m.map((function(e){return Object(K.jsx)(W,{id:e,index:0})}),t):m.map((function(e){return t[e].tags.filter((function(e){return r.includes(e)})).length>0?Object(K.jsx)(W,{id:e,index:0}):""}),t)}),Object(K.jsx)("div",{children:"logged in"===s?Object(K.jsxs)("div",{children:[Object(K.jsx)("div",{className:"bottom-container",children:Object(K.jsx)(X,{})}),Object(K.jsx)("div",{className:"d-grid gap-2 col-6 mx-auto",children:Object(K.jsxs)("button",{className:"btn btn-warning ",type:"button",onClick:function(){return u()},children:["logout ",Object(K.jsx)(G.a,{icon:M.j})]})})]}):Object(K.jsx)(q,{})})]}):Object(K.jsx)(K.Fragment,{children:Object(K.jsx)(W,{id:c,index:1})})})},ee=function(){return Object(l.b)()(I()),Object(K.jsxs)("div",{className:"container main my-4",children:[Object(K.jsxs)("h1",{children:["Zitao's Discussion Board ",Object(K.jsx)(G.a,{icon:M.c})]}),Object(K.jsx)($,{})]})},te=function(e){e&&e instanceof Function&&s.e(3).then(s.bind(null,47)).then((function(t){var s=t.getCLS,a=t.getFID,c=t.getFCP,n=t.getLCP,i=t.getTTFB;s(e),a(e),c(e),n(e),i(e)}))};i.a.render(Object(K.jsx)(c.a.StrictMode,{children:Object(K.jsx)(l.a,{store:F,children:Object(K.jsx)(ee,{})})}),document.getElementById("root")),te()}},[[45,1,2]]]);
//# sourceMappingURL=main.5321fa32.chunk.js.map